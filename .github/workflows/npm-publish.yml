on:
  push:
    branches:
      - main
  jobs:
    name: NPM package


    on : 
      release:
        types:[created]

    jobs:
      build:
        runs-on: ubuntu-latest
        steps:
        - uses: actions/checkout@v4
        - uses: actions/setup-node@v4    
          with: 
            node-version: 20
        - run: npm i && npm run code:publish

      publish-npm:
        needs: build
        runs-on: ubuntu-latest
        steps:
         - uses: actions/checkout@v4
         - uses: actions/setup-node@v4    
          with: 
            node-version: 20
            registry-url: https://registry.npmjs.org/
        - run: npm i && npm test
          env:
            NPM_TOKEN: ${{secrets.NPM_PUBLISH}}    